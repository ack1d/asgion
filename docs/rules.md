<!-- Auto-generated by docs/generate_rules.py - do not edit manually -->

# Asgion Rules Reference

All validation rules that Asgion checks, grouped by protocol layer.

Rules are based on the [ASGI spec](https://asgi.readthedocs.io/en/latest/) ([asgiref](https://github.com/django/asgiref)).

**Total: 164 rules**

| Severity | Meaning |
|----------|---------|
| `error` | ASGI spec violation - something is broken |
| `warning` | Potential problem - likely a bug |
| `info` | Recommendation - could be improved |
| `perf` | Performance concern |

> To suppress specific rules:
> ```python
> inspect(app, exclude_rules={"HE-012", "G-008"})
> ```

---

## General ASGI (Layer 0)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/main.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `G-001` | error | Scope must be a dict | - |
| `G-002` | error | Scope must contain key 'type' | - |
| `G-003` | error | scope['type'] must be a str | - |
| `G-004` | error | Unknown scope type | Expected 'http', 'websocket', or 'lifespan' |
| `G-005` | error | Message must be a dict | - |
| `G-006` | error | Message must contain key 'type' | - |
| `G-007` | error | message['type'] must be a str | - |
| `G-008` | error | NaN value in message | ASGI spec forbids NaN in messages |
| `G-009` | error | Infinity value in message | ASGI spec forbids Infinity in messages |
| `G-010` | error | Forbidden type in message | ASGI messages may only contain: bytes, str, int, float, list, dict, bool, None |
| `G-011` | error | Scope must contain 'asgi' dict with version info | - |
| `G-012` | error | asgi['version'] must be '2.0' or '3.0' | - |
| `G-013` | warning | asgi['spec_version'] should be a str | - |
| `G-014` | warning | Message nesting exceeds maximum depth | - |

## HTTP Scope Fields (Layer 1)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/www.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `HS-001` | error | Scope type is not 'http' | - |
| `HS-002` | error | scope missing 'http_version' field | - |
| `HS-003` | error | scope['http_version'] must be str | - |
| `HS-004` | warning | Unknown HTTP version in scope | Expected one of: 1.0, 1.1, 2, 3 |
| `HS-005` | error | scope missing 'method' field | - |
| `HS-006` | error | scope['method'] must be str | - |
| `HS-007` | warning | HTTP method should be uppercase | - |
| `HS-008` | error | scope missing 'scheme' field | - |
| `HS-009` | error | scope['scheme'] must be str | - |
| `HS-010` | warning | Unknown HTTP scheme | Expected 'http' or 'https' |
| `HS-011` | error | scope missing 'path' field | - |
| `HS-012` | error | scope['path'] must be str | - |
| `HS-013` | warning | HTTP path should start with '/' | - |
| `HS-014` | error | scope missing 'raw_path' field | - |
| `HS-015` | error | scope['raw_path'] must be bytes | - |
| `HS-016` | error | scope missing 'query_string' field | - |
| `HS-017` | error | scope['query_string'] must be bytes | - |
| `HS-018` | error | scope missing 'root_path' field | - |
| `HS-019` | error | scope['root_path'] must be str | - |
| `HS-020` | error | scope missing 'headers' field | - |
| `HS-021` | error | scope headers format invalid | - |
| `HS-022` | error | Header name must be bytes | - |
| `HS-023` | error | Header value must be bytes | - |
| `HS-024` | warning | Header name should be lowercase | - |
| `HS-025` | error | Invalid client format in HTTP scope | client must be None or [host: str, port: int] |
| `HS-026` | error | Invalid server format in HTTP scope | server must be None or [host: str, port: int\|None] |
| `HS-027` | error | Invalid extensions type in HTTP scope | extensions must be None or dict |
| `HS-028` | error | Invalid state type in HTTP scope | state must be a dict |

## WebSocket Scope Fields (Layer 2)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/websocket.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `WS-001` | error | Scope type is not 'websocket' | - |
| `WS-002` | error | scope missing 'http_version' field | - |
| `WS-003` | error | scope['http_version'] must be str | - |
| `WS-004` | error | scope missing 'scheme' field | - |
| `WS-005` | error | scope['scheme'] must be str | - |
| `WS-006` | warning | Unknown WebSocket scheme | Expected 'ws' or 'wss' |
| `WS-007` | error | scope missing 'path' field | - |
| `WS-008` | error | scope['path'] must be str | - |
| `WS-009` | error | scope missing 'raw_path' field | - |
| `WS-010` | error | scope['raw_path'] must be bytes | - |
| `WS-011` | error | scope missing 'query_string' field | - |
| `WS-012` | error | scope['query_string'] must be bytes | - |
| `WS-013` | error | scope missing 'root_path' field | - |
| `WS-014` | error | scope['root_path'] must be str | - |
| `WS-015` | error | scope missing 'headers' field | - |
| `WS-016` | error | scope headers format invalid | - |
| `WS-017` | error | Header name must be bytes | - |
| `WS-018` | error | Header value must be bytes | - |
| `WS-019` | warning | Header name should be lowercase | - |
| `WS-020` | error | scope missing 'subprotocols' field | - |
| `WS-021` | error | Invalid subprotocols format | subprotocols must be an iterable of str |
| `WS-022` | error | Invalid client format in WebSocket scope | - |
| `WS-023` | error | Invalid server format in WebSocket scope | - |
| `WS-024` | error | Invalid extensions type in WebSocket scope | - |
| `WS-025` | error | Invalid state type in WebSocket scope | - |

## Lifespan Scope Fields (Layer 3)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/lifespan.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `LS-001` | error | Scope type is not 'lifespan' | - |
| `LS-002` | error | scope missing 'asgi' field | - |
| `LS-003` | error | scope['asgi'] must be dict | - |
| `LS-004` | error | Invalid state type in lifespan scope | - |

## HTTP Events (Layer 4)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/www.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `HE-001` | error | http.request missing 'body' field | - |
| `HE-002` | error | http.request['body'] must be bytes | - |
| `HE-003` | warning | http.request['more_body'] should be bool | - |
| `HE-004` | error | Invalid HTTP receive event type | Expected 'http.request' or 'http.disconnect' |
| `HE-005` | error | http.response.start missing required 'status' field | - |
| `HE-006` | error | http.response.start['status'] must be int | - |
| `HE-007` | warning | Unusual HTTP status code | Expected status in range 100-599 |
| `HE-008` | error | http.response.start headers format invalid | - |
| `HE-009` | warning | Header name should be lowercase | - |
| `HE-010` | warning | transfer-encoding header in response | ASGI servers manage transfer-encoding automatically |
| `HE-011` | warning | http.response.start['trailers'] should be bool | - |
| `HE-012` | error | http.response.body['body'] must be bytes | - |
| `HE-013` | warning | http.response.body['more_body'] should be bool | - |
| `HE-014` | error | Invalid HTTP send event type | Expected one of: http.response.body, http.response.debug, http.response.early_hint, http.response.pathsend, http.response.push, http.response.start, http.response.trailers, http.response.zerocopysend |
| `HE-015` | error | http.response.trailers headers format invalid | - |
| `HE-016` | error | http.response.push missing 'path' field | - |
| `HE-017` | error | http.response.push['path'] must be str | - |
| `HE-018` | error | http.response.push headers format invalid | - |
| `HE-019` | error | http.response.zerocopysend missing 'file' field | - |
| `HE-020` | error | http.response.pathsend missing 'path' field | - |
| `HE-021` | error | http.response.pathsend['path'] must be str | - |
| `HE-022` | error | http.response.early_hint headers format invalid | - |
| `HE-023` | error | http.response.debug['info'] must be dict | - |

## HTTP State Machine (Layer 7)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/www.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `HF-001` | error | http.response.start was never sent | Application must send exactly one http.response.start per request |
| `HF-002` | error | http.response.body sent without preceding http.response.start | Send http.response.start before any http.response.body |
| `HF-003` | error | Duplicate http.response.start | http.response.start must be sent exactly once per request |
| `HF-004` | error | http.response.body sent after response was already completed | Do not send body after more_body=False |
| `HF-005` | error | Send after client disconnected | Check for http.disconnect before sending response |
| `HF-006` | info | App exited without completing response body | Ensure http.response.body with more_body=False is sent |
| `HF-007` | info | Received http.request after body was already complete | After more_body=False, further receives return http.disconnect |
| `HF-008` | error | trailers=True in response.start but no http.response.trailers sent | Send http.response.trailers after the final response body |
| `HF-009` | error | Trailers sent without trailers=True in response.start | Set trailers=True in http.response.start to use trailer headers |
| `HF-010` | info | Streaming response body (more_body=True) | Application is sending chunked response body |
| `HF-011` | info | HEAD request response has non-empty body | ASGI servers strip body for HEAD; consider doing it in the app for clarity |
| `HF-012` | warning | Response has body when status code forbids it | 1xx/204/304 responses must not include a body |

## WebSocket Events (Layer 5)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/websocket.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `WE-001` | error | websocket.receive must have exactly one of 'bytes' or 'text' as non-None | Set one to a value and the other to None |
| `WE-002` | error | websocket.receive['bytes'] must be None or bytes | - |
| `WE-003` | error | websocket.receive['text'] must be None or str | - |
| `WE-004` | error | websocket.disconnect['code'] must be int | - |
| `WE-005` | warning | websocket.disconnect['reason'] should be str or None | - |
| `WE-006` | warning | websocket.accept['subprotocol'] should be str or None | - |
| `WE-007` | error | websocket.accept headers format invalid | - |
| `WE-008` | error | websocket.send must have exactly one of 'bytes' or 'text' as non-None | - |
| `WE-009` | error | websocket.send['bytes'] must be None or bytes | - |
| `WE-010` | error | websocket.send['text'] must be None or str | - |
| `WE-011` | error | websocket.close['code'] must be int | - |
| `WE-012` | warning | websocket.close['reason'] should be str or None | - |
| `WE-013` | error | websocket.http.response.start['status'] must be int | - |
| `WE-014` | error | WS denial response headers format invalid | - |
| `WE-015` | error | websocket.http.response.body['body'] must be bytes | - |
| `WE-016` | warning | websocket.http.response.body['more_body'] should be bool | - |

## WebSocket State Machine (Layer 8)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/websocket.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `WF-001` | error | websocket.connect received in unexpected state | websocket.connect should be the first message |
| `WF-002` | error | websocket.accept sent in wrong state | Send accept only after receiving websocket.connect |
| `WF-003` | error | websocket.send before websocket.accept | Accept the WebSocket connection before sending data |
| `WF-004` | error | websocket.send after websocket.close was sent | Cannot send data after closing the connection |
| `WF-005` | error | Send/close after websocket.disconnect | Client has disconnected, cannot send data |
| `WF-006` | error | Duplicate websocket.accept | - |
| `WF-007` | info | websocket.close sent before accept - will result in HTTP 403 | This is valid for rejecting connections |
| `WF-008` | error | send() called after websocket.close | - |
| `WF-009` | error | websocket.http.response.start sent in wrong state | HTTP denial response can only be sent before accepting |
| `WF-010` | error | websocket.http.response.body without preceding http.response.start | - |
| `WF-011` | error | websocket.send after HTTP denial response started | Cannot send WebSocket data during HTTP denial flow |
| `WF-012` | warning | websocket.receive after connection closed | - |

## Lifespan Events (Layer 6)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/lifespan.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `LE-001` | error | Invalid lifespan receive event type | Expected one of: lifespan.shutdown, lifespan.startup |
| `LE-002` | error | Invalid lifespan send event type | Expected one of: lifespan.shutdown.complete, lifespan.shutdown.failed, lifespan.startup.complete, lifespan.startup.failed |
| `LE-003` | error | lifespan.startup.failed['message'] must be str | - |
| `LE-004` | error | lifespan.shutdown.failed['message'] must be str | - |

## Lifespan State Machine (Layer 9)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/lifespan.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `LF-001` | error | lifespan.startup received in unexpected state | - |
| `LF-002` | error | lifespan.startup.complete/failed sent in wrong state | - |
| `LF-003` | error | Duplicate lifespan.startup.complete | - |
| `LF-004` | error | startup.complete and startup.failed are mutually exclusive | Send exactly one of startup.complete or startup.failed |
| `LF-005` | error | lifespan.shutdown received before startup.complete | Shutdown should only occur after successful startup |
| `LF-006` | error | lifespan.shutdown.complete/failed sent in wrong state | - |
| `LF-007` | error | shutdown.complete and shutdown.failed are mutually exclusive | - |
| `LF-008` | info | App exited during shutdown without sending complete/failed | - |
| `LF-009` | warning | App exited during startup without sending startup.complete or startup.failed | An exception during startup is not the same as startup.failed â€” send the proper signal |
| `LF-010` | info | Lifespan state dict is available for sharing state with requests | state is mutable in lifespan scope and shallow-copied to request scopes |

## HTTP Extensions (Layer 10)

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `EX-009` | error | Extension event sent without corresponding scope extension | scope['extensions'] must contain the extension key |
| `EX-010` | error | http.response.early_hint sent after http.response.start | Early hints must be sent before the response starts |
| `EX-011` | error | http.response.debug sent after http.response.start | Debug info should be sent before the response starts |

## HTTP Semantic (Layer 11)

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `SEM-001` | warning | Duplicate Content-Type header in response | Only one Content-Type header should be sent |
| `SEM-002` | info | No Content-Type header on 2xx response | Responses with a body should include a Content-Type header |
| `SEM-003` | warning | Content-Length does not match actual body size | - |
| `SEM-004` | warning | Set-Cookie without Secure flag on http:// scheme | Cookies on plaintext HTTP can be intercepted |
| `SEM-005` | info | App completed without receiving http.disconnect | Long-running handlers should listen for http.disconnect to detect client drops |
| `SEM-006` | perf | Slow time to first byte | Response started more than 5s after receiving the request |
| `SEM-007` | perf | Total request lifecycle exceeded threshold | Connection took more than 30s from start to completion |
| `SEM-008` | perf | Large response body | Response body exceeds 10 MB; consider streaming or compression |
| `SEM-009` | info | Response body not streamed | Large body sent in a single chunk; consider streaming with more_body=True |
| `SEM-010` | perf | Slow response body delivery | Time from response start to body complete exceeds 10s |
| `SEM-011` | info | Excessive body chunk fragmentation | Response sent in more than 100 chunks; consider larger writes |
| `SEM-012` | warning | CORS misconfiguration: wildcard origin with credentials | Access-Control-Allow-Origin: * and Access-Control-Allow-Credentials: true is rejected by browsers; restrict the origin to a specific value |
| `SEM-013` | info | text/* response missing charset in Content-Type | Add charset=utf-8 to avoid encoding ambiguity, e.g. text/html; charset=utf-8 |
