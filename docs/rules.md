<!-- Auto-generated by docs/generate_rules.py - do not edit manually -->

# Asgion Rules Reference

All validation rules that Asgion checks, grouped by protocol layer.

Rules are based on the [ASGI spec](https://asgi.readthedocs.io/en/latest/) ([asgiref](https://github.com/django/asgiref)).

**Total: 78 rules**

| Severity | Meaning |
|----------|---------|
| `error` | ASGI spec violation - something is broken |
| `warning` | Potential problem - likely a bug |
| `info` | Recommendation - could be improved |
| `perf` | Performance concern |

> To suppress specific rules:
> ```python
> inspect(app, exclude_rules={"HE-012", "G-008"})
> ```

---

## General ASGI (Layer 0)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/main.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `G-001` | error | Scope must be a dict | - |
| `G-002` | error | Scope must contain key 'type' | - |
| `G-003` | error | scope['type'] must be a str | - |
| `G-004` | error | Unknown scope type | Expected 'http', 'websocket', or 'lifespan' |
| `G-005` | error | Message must be a dict | - |
| `G-006` | error | Message must contain key 'type' | - |
| `G-007` | error | message['type'] must be a str | - |
| `G-008` | error | NaN value in message | ASGI spec forbids NaN in messages |
| `G-009` | error | Infinity value in message | ASGI spec forbids Infinity in messages |
| `G-010` | error | Forbidden type in message | ASGI messages may only contain: bytes, str, int, float, list, dict, bool, None |
| `G-011` | error | Scope must contain 'asgi' dict with version info | - |
| `G-012` | error | asgi['version'] must be '2.0' or '3.0' | - |
| `G-013` | warning | asgi['spec_version'] should be a str | - |
| `G-014` | warning | Message nesting exceeds maximum depth | - |

## HTTP Events (Layer 4)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/www.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `HE-001` | error | http.request missing 'body' field | - |
| `HE-002` | error | http.request['body'] must be bytes | - |
| `HE-003` | warning | http.request['more_body'] should be bool | - |
| `HE-005` | error | Invalid HTTP receive event type | Expected 'http.request' or 'http.disconnect' |
| `HE-010` | error | http.response.start missing required 'status' field | - |
| `HE-011` | error | http.response.start['status'] must be int | - |
| `HE-012` | warning | Unusual HTTP status code | Expected status in range 100-599 |
| `HE-013` | error | http.response.start headers format invalid | - |
| `HE-014` | warning | Header name should be lowercase | - |
| `HE-015` | warning | transfer-encoding header in response | ASGI servers manage transfer-encoding automatically |
| `HE-016` | warning | http.response.start['trailers'] should be bool | - |
| `HE-017` | error | http.response.body['body'] must be bytes | - |
| `HE-018` | warning | http.response.body['more_body'] should be bool | - |
| `HE-019` | error | Invalid HTTP send event type | Expected one of: http.response.body, http.response.debug, http.response.early_hint, http.response.pathsend, http.response.push, http.response.start, http.response.trailers, http.response.zerocopysend |

## HTTP State Machine (Layer 7)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/www.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `HF-001` | error | http.response.start was never sent | Application must send exactly one http.response.start per request |
| `HF-003` | error | http.response.body sent without preceding http.response.start | Send http.response.start before any http.response.body |
| `HF-004` | error | Duplicate http.response.start | http.response.start must be sent exactly once per request |
| `HF-006` | error | http.response.body sent after response was already completed | Do not send body after more_body=False |
| `HF-007` | error | Send after client disconnected | Check for http.disconnect before sending response |
| `HF-008` | info | App exited without completing response body | Ensure http.response.body with more_body=False is sent |
| `HF-009` | info | Received http.request after body was already complete | After more_body=False, further receives return http.disconnect |
| `HF-010` | error | trailers=True in response.start but no http.response.trailers sent | Send http.response.trailers after the final response body |
| `HF-011` | error | Trailers sent without trailers=True in response.start | Set trailers=True in http.response.start to use trailer headers |
| `HF-014` | warning | HEAD request response has non-empty body | HEAD responses must not include a body |
| `HF-015` | warning | Response has body when status code forbids it | 1xx/204/304 responses must not include a body |

## WebSocket Events (Layer 5)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/websocket.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `WE-002` | error | websocket.receive must have exactly one of 'bytes' or 'text' as non-None | Set one to a value and the other to None |
| `WE-003` | error | websocket.receive['bytes'] must be None or bytes | - |
| `WE-004` | error | websocket.receive['text'] must be None or str | - |
| `WE-005` | error | websocket.disconnect['code'] must be int | - |
| `WE-007` | warning | websocket.disconnect['reason'] should be str or None | - |
| `WE-010` | warning | websocket.accept['subprotocol'] should be str or None | - |
| `WE-011` | error | websocket.accept headers format invalid | - |
| `WE-012` | error | websocket.send must have exactly one of 'bytes' or 'text' as non-None | - |
| `WE-013` | error | websocket.send['bytes'] must be None or bytes | - |
| `WE-014` | error | websocket.send['text'] must be None or str | - |
| `WE-015` | error | websocket.close['code'] must be int | - |
| `WE-016` | warning | websocket.close['reason'] should be str or None | - |
| `WE-020` | error | websocket.http.response.start['status'] must be int | - |
| `WE-021` | error | WS denial response headers format invalid | - |
| `WE-022` | error | websocket.http.response.body['body'] must be bytes | - |
| `WE-023` | warning | websocket.http.response.body['more_body'] should be bool | - |

## WebSocket State Machine (Layer 8)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/websocket.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `WF-001` | error | websocket.connect received in unexpected state | websocket.connect should be the first message |
| `WF-002` | error | websocket.accept sent in wrong state | Send accept only after receiving websocket.connect |
| `WF-003` | error | websocket.send before websocket.accept | Accept the WebSocket connection before sending data |
| `WF-004` | error | websocket.send after websocket.close was sent | Cannot send data after closing the connection |
| `WF-005` | error | Send/close after websocket.disconnect | Client has disconnected, cannot send data |
| `WF-006` | error | Duplicate websocket.accept | - |
| `WF-007` | info | websocket.close sent before accept - will result in HTTP 403 | This is valid for rejecting connections |
| `WF-008` | error | send() called after websocket.close | - |
| `WF-009` | error | websocket.http.response.start sent in wrong state | HTTP denial response can only be sent before accepting |
| `WF-010` | error | websocket.http.response.body without preceding http.response.start | - |
| `WF-012` | warning | websocket.receive after connection closed | - |

## Lifespan Events (Layer 6)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/lifespan.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `LE-001` | error | Invalid lifespan receive event type | Expected one of: lifespan.shutdown, lifespan.startup |
| `LE-003` | error | Invalid lifespan send event type | Expected one of: lifespan.shutdown.complete, lifespan.shutdown.failed, lifespan.startup.complete, lifespan.startup.failed |
| `LE-004` | error | lifespan.startup.failed['message'] must be str | - |
| `LE-006` | error | lifespan.shutdown.failed['message'] must be str | - |

## Lifespan State Machine (Layer 9)
> Spec: <https://asgi.readthedocs.io/en/latest/specs/lifespan.html>

| ID | Severity | Summary | Hint |
|----|----------|---------|------|
| `LF-001` | error | lifespan.startup received in unexpected state | - |
| `LF-002` | error | lifespan.startup.complete/failed sent in wrong state | - |
| `LF-003` | error | Duplicate lifespan.startup.complete | - |
| `LF-004` | error | startup.complete and startup.failed are mutually exclusive | Send exactly one of startup.complete or startup.failed |
| `LF-005` | error | lifespan.shutdown received before startup.complete | Shutdown should only occur after successful startup |
| `LF-006` | error | lifespan.shutdown.complete/failed sent in wrong state | - |
| `LF-007` | error | shutdown.complete and shutdown.failed are mutually exclusive | - |
| `LF-008` | info | App exited during shutdown without sending complete/failed | - |
